<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Register | Campus Collective</title>
    <link rel="icon" type="image/x-icon" href="Images/campus collective icon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* PRESERVED: Your Exact Loader Styles */
        #loader-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9999;
        }
        .logo-container { position: relative; display: flex; justify-content: center; align-items: center; perspective: 1000px; }
        .loader-ring {
            position: absolute; width: 150px; height: 150px; border: 3px solid transparent;
            border-top: 3px solid #2563eb; border-bottom: 3px solid #ff6600; border-radius: 50%;
            animation: spin-ring 1.5s linear infinite;
        }
        .loader-logo {
            width: 110px; height: 110px; border-radius: 50%; object-fit: cover;
            animation: spin-3d 3s infinite ease-in-out; box-shadow: 0 0 25px rgba(59, 130, 246, 0.4); z-index: 10;
        }
        @keyframes spin-ring { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes spin-3d { 0% { transform: rotateY(0deg); } 50% { transform: rotateY(180deg); } 100% { transform: rotateY(360deg); } }
        .loader-text { margin-top: 30px; font-weight: 700; color: #2563eb; letter-spacing: 2px; text-transform: uppercase; animation: pulse-text 2s infinite; }
        @keyframes pulse-text { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }
        .hidden-loader { display: none !important; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div id="loader-overlay" class="hidden-loader">
        <div class="logo-container">
            <div class="loader-ring"></div>
            <img src="Images/Campus collective logo origin.jpg" alt="Loading..." class="loader-logo">
        </div>
        <div class="loader-text text-xs">Creating Account...</div>
    </div>

    <div class="w-full max-w-md bg-white p-8 rounded-xl shadow-2xl">
        <h2 class="text-3xl font-extrabold text-gray-900 text-center mb-6">Join Campus Collective üõí</h2>
        <p id="message" class="text-center mb-4 hidden"></p>

        <form id="register-form" class="space-y-6">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="firstName" class="block text-sm font-medium text-gray-700">First Name</label>
                    <input type="text" id="firstName" required class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label for="surname" class="block text-sm font-medium text-gray-700">Surname</label>
                    <input type="text" id="surname" required class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 outline-none">
                </div>
            </div>

            <div>
                <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
                <input type="text" id="phone" required class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 outline-none">
            </div>

            <div>
                <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                <input type="email" id="email" required class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 outline-none">
            </div>

            <div>
                <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                <input type="password" id="password" required class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 outline-none">
            </div>

            <button type="submit" class="w-full py-3 px-4 rounded-lg text-white bg-blue-600 hover:bg-blue-700 font-bold shadow-md transition-all">
                Register
            </button>
        </form>

        <div class="mt-6 text-center text-sm text-gray-600">
            Already have an account? <a href="customer-login.html" class="text-blue-600 hover:underline font-medium">Log in here</a>
        </div>
    </div>

    <script>
        // üèÜ FULL ADDRESS: Prevents the "Unexpected token <" error
        const API_URL = 'http://localhost:8080/api/auth/customer/register'; 

        const form = document.getElementById('register-form');
        const message = document.getElementById('message');
        const loader = document.getElementById('loader-overlay');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            loader.classList.remove('hidden-loader');
            message.classList.add('hidden');

            // Collect all data including the new Phone and Surname
            const registerData = {
                firstName: document.getElementById('firstName').value,
                surname: document.getElementById('surname').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                role: 'Customer'
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(registerData)
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.message || 'Registration failed.');
                
                document.querySelector('.loader-text').textContent = "Account Ready! Redirecting...";
                setTimeout(() => { window.location.href = 'customer-login.html'; }, 2000);

            } catch (error) {
                loader.classList.add('hidden-loader');
                message.textContent = error.message; 
                message.className = 'p-3 bg-red-100 text-red-700 rounded-lg text-center mb-4 font-bold';
                message.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>